<div class="annotation-input"
     (mousedown)="$event.stopPropagation()"
     (mouseup)="$event.stopPropagation()"
     [ngStyle]="{'left.px': x(), 'top.px': y() + height() + 4}"
     (paste)="onPaste($event)">
  <div class="input-container">
    <input #textInput
           type="text"
           [(ngModel)]="textValue"
           placeholder="Введите текст аннотации"
           (keyup.enter)="onSaveClick()"
           (keyup.escape)="onCancelClick()">
    
    <div class="image-preview" *ngIf="imageUrl()">
      <div class="preview-container">
        <img [src]="imageUrl()" 
             [style.width.px]="previewWidth()"
             [style.height.px]="previewHeight()"
             [alt]="'Изображение аннотации'">
        <button class="remove-button" (click)="removeImage(); $event.stopPropagation()">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="buttons">
      <button (click)="fileInput.click(); $event.stopPropagation()">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14 10V12.6667C14 13.0203 13.8595 13.3594 13.6095 13.6095C13.3594 13.8595 13.0203 14 12.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M11.3333 5.33333L8 2L4.66667 5.33333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M8 2V10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Вставить изображение
      </button>
      <button class="primary" (click)="onSaveClick()">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M13.3333 4L5.99999 11.3333L2.66666 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Сохранить
      </button>
      <button class="danger" (click)="onCancelClick()">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Отмена
      </button>
    </div>
  </div>

  <input #fileInput
         type="file"
         accept="image/*"
         style="display: none"
         (change)="onFileSelected($event)" />
</div> 